{% extends 'base.html' %}
{% block title %}Expense{% endblock %}
{% block header %}Expense{% endblock %}
{% block content %}
    <!-- Add Expense Modal -->
    <div id="expenseModal" class="modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.15);z-index:1000;align-items:center;justify-content:center;">
        <div class="form-section" style="max-width:500px;margin:auto;box-shadow:0 4px 24px rgba(0,0,0,0.12);position:relative;">
            <button onclick="closeExpenseModal()" style="position:absolute;top:18px;right:18px;background:none;border:none;font-size:1.5em;color:#888;cursor:pointer;">&times;</button>
            <h2 style="margin-top:10px;">Add Expense</h2>
            <form method="post" class="styled-form">
                <input type="number" name="amount" placeholder="Amount" required>
                <input type="text" name="description" placeholder="Description" required>
                <input type="date" name="date" required>
                <button type="submit" style="background:#3f51b5;font-weight:700;font-size:1.1em;">Add Expense</button>
            </form>
        </div>
    </div>
    <div class="table-section">
        <h2 style="margin-bottom:0;">Expense List</h2>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
            <span style="font-weight:500;">{{ expenses|length }} Records Found.</span>
            <form method="get" style="display:flex;align-items:center;gap:5px;">
                <input type="text" name="search" placeholder="Search Here" value="{{ request.args.get('search', '') }}" style="padding:8px 12px;border-radius:5px;border:1px solid #ccc;">
                <input type="date" name="start_date" value="{{ request.args.get('start_date', '') }}" style="padding:8px 12px;border-radius:5px;border:1px solid #ccc;" title="Start Date">
                <input type="date" name="end_date" value="{{ request.args.get('end_date', '') }}" style="padding:8px 12px;border-radius:5px;border:1px solid #ccc;" title="End Date">
                <button type="submit" style="padding:8px 16px;background:#1976d2;color:#fff;border:none;border-radius:5px;">&#128269;</button>
            </form>
            <a href="#" onclick="openExpenseModal();return false;" style="padding:8px 16px;background:#1976d2;color:#fff;border:none;border-radius:5px;text-decoration:none;">New Expense</a>
            <a href="{{ url_for('expense_history') }}" style="padding:8px 16px;background:#fff;color:#1976d2;border:1px solid #1976d2;border-radius:5px;text-decoration:none;margin-left:8px;">All History</a>
<script>
function openExpenseModal() {
    document.getElementById('expenseModal').style.display = 'flex';
}
function closeExpenseModal() {
    document.getElementById('expenseModal').style.display = 'none';
}
</script>
        </div>
        <table style="border-collapse:collapse;width:100%;">
            <tr style="background:#1976d2;color:#fff;">
                <th style="padding:12px;">Sr.No</th>
                <th style="padding:12px;">Amount</th>
                <th style="padding:12px;">Description</th>
                <th style="padding:12px;">Date</th>
                <th style="padding:12px;">Delete</th>
            </tr>
            {% for expense in expenses %}
            {% if loop.index0 % 2 == 0 %}
            <tr style="background:#f9f9f9;">
            {% else %}
            <tr style="background:#fff;">
            {% endif %}
                <td style="padding:12px;">{{ loop.index }}</td>
                <td style="padding:12px;">{{ expense[1] }}</td>
                <td style="padding:12px;">{{ expense[2] }}</td>
                <td style="padding:12px;">{{ expense[3] }}</td>
                <td style="padding:12px;text-align:center;">
                    <form action="/delete_expense/{{ expense[0] }}" method="post" style="display:inline;">
                        <button type="submit" onclick="return confirm('Delete this expense?');" style="background:none;border:none;cursor:pointer;">
                            <span style="font-size:1.3em;color:#e53935;">&#128465;</span>
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
{% endblock %}
